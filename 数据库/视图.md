# 视图

视图是从一个或多个表中查询数据的另外一种方式。利用视图，用户可以集中、简化、定制数据库，同时还可以提供安全保证。

视图是从一个或多个表中导出的表，其结构和数据是建立在对表的查询基础上的。和表一样，视图也是包括几个被定义的数据列和多个数据行，但就本质而言，这些数据列和数据行来源于它所引用的表。所以视图不是真实存在的基础表，而是一张虚表。

> **强调一点**，视图在物理上是不存在的，它实际上只是一个查询结果，是一个被存储的查询。与创建表CREATE TABLE语句不同，CREATE TABLE语句在系统目录中保存表，而CREATE VIEW语句只保存视图的定义。所以DROP VIEW语句删除视图时，删除的也只是视图的定义，对实际表中的数据并没有任何影响。

## 优点

- **简化操作。** 视图大大简化了用户对数据的操作。在定义视图时，视图本身就可以是一个复杂查询的结果集。因此，在每一次执行相同的查询时，不必重新写这些复杂的查询语句，只要一条简单的查询视图语句即可。
- **定制数据。** 视图能够让不同的用户、以不同的方式看到不同或相同的数据集。因此，当有许多不同水平的用户共用同一数据库时，这显得极为重要。比如，我们想让公司的用户访问某些职员记录，但不想让这些用户获得诸如医疗卡号或工资之类的信息，那么就可以创建一个视图，只为他们提供应该看到的信息。
- **合并分隔数据。** 在有些情况下，由于表中数据量太大，在表的设计时，常将表进行水平分割或垂直分割，但表的结构的变化却会对应用程序产生不良的影响。使用视图就可以重新保持原有的结构关系，从而使外模式保持不变，原有的应用程序仍可以通过视图来重载数据。
- **安全性。** 视图可以作为一种安全机制。通过视图，用户只能查看和修改他们所能看到的数据。其他数据库或表既不可见，也不可以访问。如果某一用户想要访问视图的结果集，必须授予其访问权限。视图所引用表的访问权限与视图权限的设置互不影响。

## 缺点

- **性能。** 由于视图是虚拟的表，在使用包括视图引用的SQL语句时，数据库除了执行所键入的SQL语句中的查询或更新之外，还要告诉DBMS执行定义视图的查询，这就影响了查询效率。
- **更新限制。** 不是所有的视图都是可更新的。目前，SQL将可更新的视图限制为基于对单个表的，并且没有GROUP BY或者HAVING子句的查询。除此之外，为了使视图是可更新的，视图不能使用聚集函数、计算的列或SELECT DISTINCT子句。

由于SQL对更新视图的限制，用户不能总是用视图来代替表。另外，在使用视图的情况下，我们要综合考虑使用视图的优势和DBMS每次执行创建视图的SQL语句引起的性能损失。

## 创建与销毁

### 创建语法

视图的创建主要由CREATE VIEW关键字实现，其数据则由SELECT语句定义。语法如下。

```sql
create view <view_name> [(column1, column2...)] as select <column_names> from <table_name>
```

[(column1, column2...)]为可选项，缺省时，为子查询结果中的字段名。SELECT语句指明了视图中的字段及其数据。

### 销毁语法

```sql
drop view view_name
```

### 关于视图我们还要强调两点:
* 视图创建后，在数据字典中只存放视图的定义，而其中的SELECT语句并不执行。
* 只有当用户对视图进行操作时，才按照视图的定义将数据从基本表中取出。

**实际上，可以把视图看成是一个表，可以为视图创建视图。**

## 注意
用户可以通过创建视图进行数据查询。例如，一个表有50列，有成千上万行，而用户只需要使用表中的两列数据，这时，我们可以为这两列创建一个视图，在视图中查询需要的数据，这样会大大**提高查询效率**。

## 利用视图简化表的复杂连接

视图的一个**重要用途**就是进行复杂的SQL数据处理。通过创建视图，我们可以实现多表之间的复杂连接。将频繁使用的连接定义成视图后，用户就不必每次使用时都要指定复杂的连接条件了。

## 利用视图简化复杂查询

在多表之间进行一系列复杂查询时，利用视图可以将查询条件层层分解，简化查询过程。(用自己的话说就是像解方程一样,一步一步使用视图去进行分解步骤的查询)

## 使用原则

* 和表一样，视图必须有惟一的名字。不仅视图之间不允许有相同的名字，并且视图与表也不允许拥有相同的名字。
* 视图的创建个数不受限制，用户可以创建任意多个视图。
* 用户要创建视图，必须从数据库管理员那里得到创建权限。
* 视图可以嵌套，即可以创建视图的视图。
* 一些数据库管理系统（如SQL Server）禁止用户在查询语句中使用ORDER BY子句。